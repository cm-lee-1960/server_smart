{% extends "analysis/base.html" %}
{% load static %}
{% block contents %}
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>일일보고 데이터 등록</title>


<!-- 쿠키보안 -->
<script>
    document.cookie = "safeCookie1=foo;SameSite=Lax";
    document.cookie = "safeCookie2=foo";
    document.cookie = "crossCookie=bar;SameSite=None;Secure";
</script>

<!-- 모달 기본 라이브러리 -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css">
<script defer src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
<script type="text/javascript" defer src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script type="text/javascript" defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"></script>
<script type="text/javascript" defer src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>-->


<!-- CSS,JS 호출 -->
<!-- <link rel="stylesheet" type="text/css" href="{% static "css/style.css" %}"> -->
<link rel="stylesheet" type="text/css" href="{% static "css/modal.css" %}">
<script type="text/javascript" defer src="{% static "js/modal.js" %}"></script>
<script type="text/javascript" defer src="{% static "js/jquery-3.4.1.min.js" %}"></script>

<style>
    .today_count{ color: red; }
    p { margin:20px 0px; }
    .area_exit{  width:30px; height:30px; }

    {% comment %} #phoneGroupDetail_header{ width:2000px; display: flex; justify-content: space-between; }
    #phoneGroupDetail_body{ width:2000px; display: flex; justify-content: space-between; height: 320px; overflow-y: auto; } {% endcomment %}
    #main_body .table thead th{
        width:125px;
    }
    #main_body .table tbody td{
        width:125px;
    }
    #main_body .table tbody .big_td{
        width:270px;
    }
    #main_body .table thead .big_th{
        width:270px;
    }

    #bottom_body_left .table thead th{
        width:200px;
    }
    #bottom_body_left .table tbody td{
        width:200px;
    }
    #bottom_body_left .table tbody .big_td{
        width:700px;
    }
    #bottom_body_left .table thead .big_th{
        width:700px;
    }

    .table tbody::-webkit-scrollbar {
    height:auto;
    width:5px;
    }
    .table tbody::-webkit-scrollbar-track {
    background-color: transparent;
    }
    .table tbody::-webkit-scrollbar-thumb {
    border-radius: 3px; 
    background-color: gray;
    }
    .table tbody::-webkit-scrollbar-button {
    width: 0;
    height: 0;
    }

</style>
</head>

<!--진자로 데이터 넘기기-->
<body>    
{% csrf_token %}
{% load static %}
    
    <!-- 상단 내용 -->
    <!--<div style="margin-bottom:10px;border: 2px solid rgb(228, 223, 223); padding: 5px; width:80vh; height:70px">
        <div style="margin-top:5px; display: flex; justify-content: space-between;">
            <div>
                <div style="float:left; margin-bottom:0px">
                    <h6> 오늘의 측정 </h6> 
                </div>
                <div style="float:left; margin-bottom:0px">
                    <input style="height: 24px;" type="date" class="form-control" name="date" id="date" value=>
                </div>
                <div style="float:left; margin-bottom:0px">
                    <button style="height: 24px;" id = "daychoice" onclick="input()">선택</button>
                </div>
                <div style="float:left; margin-bottom:0px">
                    <button style="height: 24px;" id = "daychoice" onclick="startTimer_listdata()">시작</button>
                </div>
            </div> -->
            {% comment %} <div>
                <h6 style="display:inline; margin-bottom:0px"> 금일 총 </h6> <!--3개조 가져와야한다. -->
                <h6 id="toDayGroup" style="display:inline; margin-bottom:0px"> 3개 조 </h6> <!--3개조 가져와야한다.이건 추후-->
            </div> {% endcomment %} 
        <!-- </div>   
        <div class="output">
            <table id="toDayWindow" sytle="border-spacing: 5px;">
                <tbody id='toDayDetail'>
                    <tr id='toDayDetailTr'>
                    </tr>
                </tbody>
            </table>
        </div> 
    </div> -->

    <!-- 상단 내용 -->
    <div class="row">
        <div class="col-10 px-2">
            <div id = "toDayWindow" class="row text-center">
                <div class="card text-white bg-primary mx-4" style="width: 12rem; height: 7em">
                    <div class="card-header p-1">오늘의 측정</div>
                    <div class="card-body mt-0 pt-0">
                        <span style="font-size: 16px;">총 </span><span style="font-size: 24px;">3</span>
                        <span style="font-size: 16px;">조 / 측정중 </span><span id = "measure_count_vues" style="font-size: 24px;">[[total_count]]</span>
                        <div class="mt-1">
                            <input style="height: 24px; width: 150px;" type="date" class="form-control" name="date" id="date" value=>
                            {% comment %} <input style="height: 24px; width: 150px;" type="date" class="form-control" v-model="date"> {% endcomment %}
                        </div>
                    </div>
                </div>
                <div v-for="(center, index) in centerList" class="card bg-light mb-1, mx-1"
                        style="width: 10rem; height: 7em">
                    <div class="card-header p-1">[[center.centerName]]</div>
                    <div class="card-body p-2">
                        <h3 class="card-title p-0 m-0">[[center.count]]</h3>
                        <p class="card-text p-0 m-0">부가정보 표시</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-2">
            <button type="button" class="btn btn-secondary btn-lg mt-lg-5 pt-3" v-on:click="clickMeasuringEnd()">
                <h5>측정종료</h5>
            </button>
            <button type="button" class="btn btn-danger btn-lg mt-lg-5 pt-3" v-on:click="clickMeasuringClose()">
                <h5>측정마감</h5></button>
        </div>
    </div>
    
    <!-- 중단 내용 -->
    <div id = "main_body" class="w-100 fixed-table-container" style="margin-bottom:10px;border: 2px solid rgb(228, 223, 223); padding: 10px; height:435px">    
        <h6> <b>금일 측정그룹</b> </h6>
        <div class="fixed-table-body" style="text-align: center;">
            <table id="groupWindow" class='table table-hover' style = "display:block">
                <thead id = 'phoneGroupDetail_header' class="bg-light">
                </thead>
                <tbody id = 'phoneGroupDetail_body' class="table-hover" style="height:330px; overflow-y:auto; display:block">
                    {% comment %} {% for phonegroup in data %}
                        {% if phonegroup.manage == 1 %}
                        <tr id = 'phoneGroupDetail_tr_{{phonegroup.id}}' onclick='startTimer_messagedata(this.attributes["id"].value);'>
                            <td>{{phonegroup.center.centerName}}</td>
                            <td>{{phonegroup.measuringTeam}}</td>
                            <td class="big_td">{{phonegroup.userInfo1}}</td>
                            <td>{{phonegroup.morphology.morphology}}</td>
                            <td>{{phonegroup.networkId}}</td>
                            <td>{{phonegroup.dl_count}}</td>
                            <td>{{phonegroup.downloadBandwidth}}</td>
                            <td>{{phonegroup.ul_count}}</td>
                            <td>{{phonegroup.uploadBandwidth}}</td>
                            <td>{{phonegroup.nr_percent}}</td>
                            <td>{{phonegroup.event_count}}</td>
                            <td>{{phonegroup.last_updated_dt|date:"TIME_FORMAT"}}</td>
                            {% if phonegroup.active == 1 %}
                            <td>측정 중</td>
                            {% else %}
                            <td>측정종료</td>
                            {% endif %}
                            <td onclick="event.cancelBubble=true;">
                                {%  if phonegroup.active == 1  %}
                                    <img class='area_exit' id='img_group_{{phonegroup.id}}' src="{% static "admin/img/icon-yes.svg" %}" alt="종료">
                                {% else %}
                                    <img class='area_exit' id='img_group_{{phonegroup.id}}' src="{% static "admin/img/icon-no.svg" %}" alt="종료">
                                {% endif %}
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %} {% endcomment %}
                </tbody>
            </table> 
        </div>
    </div>
    <!-- 하단 내용-->
    <div style="display:flex">
        <div id = "bottom_body_left"  style="margin-bottom:5px; margin-right:10px; border: 2px solid rgb(228, 223, 223); padding: 10px; height:270px; width:1100px;">    
             <div>
                <div class="row">
                  <div class="col">
                      <ul class="nav nav-tabs">
                        <li class="nav-item">
                          <a class="nav-link active" data-toggle="tab" href="#event">이벤트</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#xroshot">문자</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#tele">텔레그램</a>
                        </li>
                      </ul>
                      <div class="tab-content" style = "height:220px; position:relative;">
                            <div class="tab-pane fade show active fixed-table-body" id="event" style="text-align: center; position:absolute">
                                <table id="eventWindow" class='table' style = "display:block">
                                    <thead id = 'eventDetail_header'>
                                        <th scope= "col">전송시간</th>
                                        <th scope= "col" class="big_th">메세지</th>
                                        <th scope= "col">전송여부</th>
                                    </thead>
                                    <tbody id = 'eventDetail_body' class="table-hover" style="height:150px; overflow-y:auto; display:block">
                                       {% for message in message_data %}
                                            {% if message.messageType == 'EVENT' %}
                                            <tr id = 'eventDetail_tr_{{message.id}}' >
                                                <td>{{message.measdate}}</td>
                                                <td class="big_td">{{message.message}}</td>
                                                <td>{{message.sended}}</td>
                                            </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table> 
                            </div>
                            <div class="tab-pane fade active fixed-table-body" id="xroshot" style="text-align: center; position:absolute">
                                <table id="xroshotWindow" class='table' style = "display:block">
                                    <thead id = 'xroshotDetail_header'>
                                        <th scope= "col">전송시간</th>
                                        <th scope= "col" class="big_th">메세지</th>
                                        <th scope= "col">전송여부</th>
                                    </thead>
                                    <tbody id = 'xroshotDetail_body' class="table-hover" style="height:150px; overflow-y:auto; display:block">
                                        {% for message in message_data %}
                                            {% if message.messageType == 'SMS' and message.sendType == 'XMCS'%}
                                                <tr id = 'eventDetail_tr_{{message.id}}' >
                                                    <td>{{message.measdate}}</td>
                                                    <td class="big_td">{{message.message}}</td>
                                                    <td>{{message.sended}}</td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table> 
                            </div>
                            <div class="tab-pane fade active fixed-table-body" id="tele" style="text-align: center; position:absolute">
                                <table id="teleWindow" class='table' style = "display:block">
                                    <thead id = 'teleDetail_header'>
                                        <th scope= "col">전송시간</th>
                                        <th scope= "col" class="big_th">메세지</th>
                                        <th scope= "col">전송여부</th>
                                    </thead>
                                    <tbody id = 'teleDetail_body' class="table-hover" style="height:150px; overflow-y:auto; display:block">
                                        {% for message in message_data %}
                                            {% if message.messageType == 'SMS' and message.sendType == 'TELE'%}
                                                <tr id = 'eventDetail_tr_{{message.id}}' >
                                                    <td>{{message.measdate}}</td>
                                                    <td class="big_td">{{message.message}}</td>
                                                    <td>{{message.sended}}</td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table> 
                            </div>
                      </div>
                   </div>
                </div>
            </div>
        </div>
        <div style="margin-bottom:5px; border: 2px solid rgb(228, 223, 223); padding: 10px; height:270px; width:780px;">    
            <h6> 금일 측정그룹 </h6>
            <div style="text-align: center;">
            </div>
        </div>
    </div>
</body>

<!--스크립트 구문 -->
<script>
    //전역변수 구간
    var group_list_check = 0 // 그룹개수 체크 글로벌

</script>
<script>

    //현재 날짜 확인
    let today = new Date();
    let year = today.getFullYear();
    let month = ('0' + (today.getMonth() + 1)).slice(-2);
    let day = ('0' + today.getDate()).slice(-2);
    let dateString = '(' + year + '-' + month  + '-' + day + ')';
    //document.getElementById("toDay").innerHTML = dateString;
    //현재날짜 이거 다시 넣어야된다.
    
    //////////////////////////////
    //전역변수 구간
    // var group_list_check = 0 // 그룹개수 체크 글로벌
    console.log(group_list_check)
    var group_list_len = 0 // 그룹개수 글로벌
    var toDayinfo = "" // 금일 날짜 변수 글로벌

    /////////////////////////////
    //초기 금일 측정 그룹 TH 셋팅
    let phSetting = ['본부','조','측정지역','모폴로지','네트워크','DL콜수','DL속도','UL콜수','UL속도','전환율','이벤트','측정시간','상태','종료'];
    thappend = ""
    $(document).ready(
        function PhoneGroupSetting(){ 
            for(let phSetting_name of phSetting){
                if(phSetting_name == "측정지역"){
                    thappend += '<th scope= "' + 'col" class="big_th">'
                    thappend += phSetting_name
                    thappend += "</th>"
                }
                else{
                    thappend += '<th scope= "' + 'col">'
                    thappend += phSetting_name
                    thappend += "</th>"
                }
                //document.querySelector('#' + meas_area_name_split_2[1] + '_count').innerHTML = meas_area_count
            }
            $('#phoneGroupDetail_header').append(thappend);
        }
    );


    ////////////////////////////////////////////////////////////////////////////
    //setinterval 관련 부분
    const GV = {
                isPause_startdata: false, 
                timer_startdata: null, 
                isPause_listdata: false, 
                timer_listdata: null,
                isPause_messagedata: false, 
                timer_messagedata: null,  
            } 
    // setinter isPauser true false로 false일때만 인터벌이 돌게끔 한다 인터벌이 큐에 쌓이는걸방지
    
    const startTimer_startdata = function(){ 
                GV.isPause_startdata = false;
                interval_startdata();  
                GV.timer_startdata = setInterval(function(){ 
                interval_startdata(); 
                }, 13000);          
    } 

    // listdata ajax실행 인터벌이 바로 실행하게 한다.
    const startTimer_listdata = function(){ 
                GV.isPause_listdata = false;
                interval_listdata();  
                GV.timer_listdata = setInterval(function(){ 
                interval_listdata(); 
                }, 30000);          
    } 
    // messagedata ajax실행 인터벌이 바로 실행하게 한다.
    {% comment %} const startTimer_messagedata = function(tr_id){
        var list_tr_id =  tr_id
        GV.isPause_messagedata = false;
        interval_messagedata(list_tr_id);  
        GV.timer_messagedata = setInterval(function(){ 
            interval_messagedata(list_tr_id); 
        }, 60000);          
    }  {% endcomment %}
    
    // interval종료
    const stopTimer = function(){ 
        clearInterval(GV.timer_listdata); 
        GV.isPause_listdata = true;
        GV.timer_startdata = true;
        GV.timer_messagedata = true;
        group_list_check = 0 // 그룹개수 체크 글로벌 
    }    
    ////////////////////////////////////////////////////////////////////////////

    function input() {
        toDayinfo = document.querySelector('input[type="date"]').value;
        console.log(toDayinfo);
    }
    ////////////////////////////////////////////////////////////////////////////
    
    const interval_listdata = function(){
    if(!GV.isPause_listdata){
    //function interval_listdata(){
            $.ajaxSetup({
                headers: { "X-CSRFToken": '{{csrf_token}}'}
            });

            $.ajax({
                type:'POST',
                url: "{% url 'analysis:listview_phoneGroupData' %}",
                dataType : 'text',
                data : {'date' : toDayinfo},
                //async: false,
                cache: false,
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                success: function(ajax_data){
                    //$('#phoneGroupDetail_body').replaceWith($('#phoneGroupDetail_body',data));
                    console.log("불러오기성공")
                    ajax_data = JSON.parse(ajax_data); //데이터넘어온다.
                    console.log("리스트체크")
                    console.log(group_list_check)
                    console.log("개수체크")
                    console.log(group_list_len)
                    console.log("그룹개수")
                    console.log(ajax_data['data'].length)

                    if(group_list_check == 0){
                        console.log("처음은 여기")
                        group_list_len = ajax_data['data'].length;
                        console.log(group_list_check)
                        startListData(ajax_data);
                        group_list_check = 1;
                    }else{
                        console.log("나중은 여기")
                        ajax_data2 = {}
                        ajax_data_arr = []
                        //$('phoneGroupDetail_body').remove();
                        //$('#phoneGroupDetail_body').append(measStatus);
                        change_check = ajax_data['data'].length - group_list_len //변화체 7 - 5 = 2
                        group_list_len = ajax_data['data'].length;
                        //if(group_list_len !== ajax_data['data'].length){
                        if(change_check !== 0){
                            /////////////////////////////
                            //0123456 01234
                            for(let i=0; i < change_check ; i++){
                                ajax_data2[i] = ajax_data['data'][ajax_data['data'].length-change_check]
                                ajax_data_arr[i] = ajax_data2[i]
                                change_check = change_check - 1;
                            }
                            ajax_data['data'] = ajax_data_arr 
                            console.log(ajax_data)

                            ////////////////////////////
                            startListData(ajax_data);
                        }
                    }
                    //1일 때는 웹페이지를 불러올때 , 0일때는 다음 시그널 
                    //0일때 이전 Ajax 키값 숫자랑 비교해서 다를때만 추가되라 
                },
                error: function(error){
                    console.log("불러오기 실패")
                    console.log(error)

                }
            });
            //group_list_check = 1;
        }
    }
    /////////////////////////////////////////////////////////////////////////
    //금일측정그룹 생성
    function startListData(ajax_data){
        console.log("잘들어오나")
        console.log(ajax_data)
        console.log(Object.keys(ajax_data).length)
        let measStatus // 초기화
        
        if (ajax_data[0] != 'nodata'){
            //for(let i = 0; i < Object.keys(ajax_data).length; i++){
            for(let i = 0; i < ajax_data['data'].length; i++){
                measStatus += '<tr id = "' + ajax_data['data'][i]['id'] + '">';
                for(var listdata_name of Object.keys(ajax_data['data'][i])){ 
                    if(listdata_name !== 'id'){

                        if(ajax_data['data'][i][listdata_name] == undefined){
                            td_data = '-'
                        }else if(ajax_data['data'][i][listdata_name] == true){
                            td_data = "측정 중"
                        }else if(ajax_data['data'][i][listdata_name] == false){
                            td_data = "측정 종료"
                        }else{
                            td_data = ajax_data['data'][i][listdata_name]
                        }

                        //data null 체크
                        if(listdata_name == 'userInfo1'){
                            measStatus += '<td class="big_td">' + td_data + '</td>';
                        }else{
                            measStatus += '<td>' + td_data + '</td>';
                        }
                    }
                }
                measStatus += '<td onclick="event.cancelBubble=true;">'
                if (ajax_data['data'][i]['active'] == 1){
                    measStatus += '<img class="area_exit" id="img_' + ajax_data['data'][i]['id'] + '" src="{% static "admin/img/icon-yes.svg" %}" alt="종료">'
                }else{
                    measStatus += '<img class="area_exit" id="img_' + ajax_data['data'][i]['id'] + '" src="{% static "admin/img/icon-no.svg" %}" alt="종료">'
                }
                measStatus += '</tr>'
            }       
        //console.log(measStatus)
        $('#phoneGroupDetail_body').append(measStatus);
        }
    }

    ///////////////////////////////////////////////////////////////////////////////
    //stratdata 부분
    //AJAX를 먼저 시작하고 딜레이
    //callback -> interval
    //function startInterval_startData(callback, seconds){ 
    //    callback(); 
    //    return setInterval(callback, seconds * 1000); 
    //}

    //비동기통신
    //2분마다 주기적 요청(현재 테스트로 10초)
    //startInterval_startData(function(){
    const interval_startdata = function(){
    if(!GV.isPause_startdata){    
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{csrf_token}}' }
        });
        
        $.ajax({  
            type:'POST',
            url: "{% url 'analysis:ajax_startdata' %}",
            dataType : 'text',
            data : {'date' : toDayinfo },
            //async:false,
            success: function(ajax_data){
                ajax_data = JSON.parse(ajax_data); //데이터넘어온다.
                console.log(ajax_data)
                
                startData_vues(ajax_data); //초기데이터 세팅
                startDataCount(ajax_data); //초기데이터 값바꾸기          
            }
            });
        //}, 30)
        }
    }

    //오늘의 측정 테이블 생성
    function startData(ajax_data){
        $('#toDayDetailTr').remove();

        //초기화
        let measStatus = '<tr id = "toDayDetailTr">';
            measStatus += '<th id="Group" style="padding-right:15px">';
            measStatus += '<span><font size="3"> 금일 총 </font></span>';
            measStatus += '<span id = "today_group" class="today_count"><font size="3"> - </font></span>'
            measStatus += '</th>';
            measStatus += '<th id = "measure" style="padding-right:15px">';
            measStatus += '<span><font size="3"> 측정 중 </font></span>';
            measStatus += '<span id = "measure_count" class="today_count"><font size="2"> 0 </font></span>'
            measStatus += '</th>';
            //measStatus += '<th id = "measure_close" style="padding-right:15px">';
            //measStatus += '<span><font size="3"> 측정종료 </font></span>';
            //measStatus += '<span id = "measure_close_count" class="today_count"><font size="2"> 0 </font></span>';
            //measStatus += '</th>';
        
        if (ajax_data['meas_area'] != 'nodata'){  // 데이터가 없으면 생성하지 않는다 지역
        //for(var meas_area of ajax_data['meas_area']){
        for(var meas_area_name of Object.keys(ajax_data['meas_area'])){
            let meas_area_name_split_1 = meas_area_name.split(',');
            measStatus += '<th id ="' + meas_area_name_split_1[1] + '" style="padding-right:15px">';
            measStatus += '<span><font size="3">' + meas_area_name_split_1[0] + '</font></span>';
            measStatus += '<span id ="' + meas_area_name_split_1[1] + '_count" class="today_count"><font size="3"> 0 </font></span>';
            measStatus += '</th>';
            }
        }
        measStatus += '</tr>';

        //console.log(measStatus)
        $('#toDayDetail').append(measStatus);

    }

    //오늘의 측정 테이블 생성
    function startData_vues(ajax_data){
        //$('#toDayDetailTr').remove();
        
        if (ajax_data['meas_area'] != 'nodata'){  // 데이터가 없으면 생성하지 않는다 지역
        //for(var meas_area of ajax_data['meas_area']){
        for(var meas_area_name of Object.keys(ajax_data['meas_area'])){
            let meas_area_name_split_1 = meas_area_name.split(',');
            let measStatus = '';
            measStatus += '<div class="card bg-light mb-1, mx-1" style="width: 10rem; height: 7em">'
            measStatus += '<div id ="' + meas_area_name_split_1[1] + '" class="card-header p-1"></div>'       
            measStatus += '<div class="card-body p-2">'
            measStatus += '<span id ="' + meas_area_name_split_1[1] + '_count" class="card-title p-0 m-0"><font size="3"> 0 </font></span>'    
            measStatus += '<p class="card-text p-0 m-0">부가정보 표시</p>'
            measStatus += '</div>'
            measStatus += '</div>'
            }
        }
        //console.log(measStatus)
        $('#toDayWindow').append(measStatus);
    }

    //오늘의 측정 테이블 값만 변경
    function startDataCount(ajax_data){
        document.querySelector('#measure_count_vues').innerHTML = ajax_data['measure_count'];
        //document.querySelector('#measure_close_count').innerHTML = ajax_data['end_count'];
        
        if (ajax_data['meas_area'] != 'nodata'){ // 데이터가 없으면 생성하지 않는다 지역
            for(let [meas_area_name, meas_area_count] of Object.entries(ajax_data['meas_area'])){
                let meas_area_name_split_2 = meas_area_name.split(',');
                document.querySelector('#' + meas_area_name_split_2[1] + '_count').innerHTML = meas_area_count
            }
        }   
    }
    ///////////////////////////////
    startTimer_startdata(); //start타이머 시작

    ///////////////////////////////
    //event 내용 생성 ajax
    {% comment %} const interval_messagedata = function(list_tr_id){
        if(!GV.isPause_messagedata){
        //function interval_listdata(){
                $.ajaxSetup({
                    headers: { "X-CSRFToken": '{{csrf_token}}' }
                });
    
                $.ajax({
                    type:'POST',
                    url: "{% url 'analysis:listview_messageData' %}",
                    dataType : 'text',
                    data : { 'groupid' : list_tr_id },
                    //async: false,
                    cache: false,
                    success: function(ajax_data){
                        ajax_data = JSON.parse(ajax_data); //데이터넘어온다.
                        console.log(ajax_data)
                        console.log("불러오기 성공")
                        //$('#bottom_body_left').replaceWith($('#bottom_body_left',data));
                    },
                    error: function(error){
                        console.log("불러오기 실패")
                        console.log(error)
    
                    }
                });
            }
        } {% endcomment %}

</script>
{% endblock %}