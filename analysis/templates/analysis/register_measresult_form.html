{% extends "analysis/base.html" %}
{% load static %}
{% block extra-style %}

<link rel="stylesheet" type="text/css" href="{% static "css/nav.css" %}">

<!-- 부트스트랩 -->
<link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/sticky-footer-navbar/sticky-footer-navbar.css">
<link rel="stylesheet" href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<!-- CSS,JS 호출 -->
<link rel="stylesheet" type="text/css" href="{% static "css/A4.css" %}">
<!-- CSS호출 -->
<link rel="stylesheet" type="text/css" href="{% static "css/report.css" %}">
<link rel="stylesheet" type="text/css" href="{% static "css/modal.css" %}">
<!-- 아이콘 -->

<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
    #btnzone{
        border-radius:0px 0px 10px 10px;
        right:100px; 
        border: 1px solid rgba(183, 180, 180, 0.839); 
        background-color: white; 
        width:280px; 
        text-align:center; 
        position:fixed; 
        margin-top:-15px; 
        padding:5px; 
        z-index:10; 
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    } 
    button{
	    display:inline;
	    margin-left:10px;
}
</style>
    <!-- 스타일 -->
<style>
    p{
        font-size: 15px;
        display: inline;
        text-align:center;
    }
    input{
        font-size: 15px;
        display: inline;
        text-align: center;
            
    }
    td{
        text-align:center;
        height:40px;
    }
</style>
<!-- 테스트사이드바 -->
<style>

	.wrapper {
		display: flex;
		align-items: stretch;
        position:fixed;
	}
	
	#sidebar {
		min-width: 250px;
		max-width: 250px;
		min-height: 100vh;
	}
	
	#sidebar.active {
		margin-left: -250px;
	}
	a[data-toggle="collapse"] {
		position: relative;
	}
	
	.dropdown-toggle::after {
		display: block;
		position: absolute;
		top: 50%;
		right: 20px;
		transform: translateY(-50%);
	}
	@media (max-width: 768px) {
		#sidebar {
			margin-left: -250px;
		}
		#sidebar.active {
			margin-left: 0;
		}
	}
	@import "https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700";
	
	
	body {
		font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
		background: #fafafa;
	}
	
	/* p {
		font-family: 'Poppins', sans-serif;
		font-size: 1.1em;
		font-weight: 300;
		line-height: 1.7em;
		color: #999;
	} */
	
	a, a:hover, a:focus {
		color: inherit;
		text-decoration: none;
		transition: all 0.3s;
	}
	
	#sidebar {
		/* don't forget to add all the previously mentioned styles here too */
		background: rgb(164, 164, 164);
		color: #fff;
		transition: all 0.3s;
	}
	
	#sidebar .sidebar-header {
		padding: 10px;
		background: #343a40;
	}
	
	#sidebar ul.components {
		padding: 20px 0;
		/* border-bottom: 1px solid #47748b; */
	}
	
	#sidebar ul p {
		color: #fff;
		padding: 10px;
	}
	
	#sidebar ul li a {
		padding: 10px;
		font-size: 1.1em;
		display: block;
	}
	#sidebar ul li a:hover {
		color: #8d8e93;
		background: #fff;
	}
	
	#sidebar ul li.active > a, a[aria-expanded="true"] {
		color: #fff;
		background: rgb(164, 164, 164);
	}
	ul ul a {
		font-size: 0.9em !important;
		padding-left: 30px !important;
		background: grey;
	}
    .bg-dark{
	background-color: #343a40 !important;
}
	</style>

{% endblock %}
{% block contents %}

<body>
<div id="app" v-cloak>    
   
<!-- 메인화면 -->
<div  style="display:flex; flex-flow: row nowrap;">
    <!-- 테스트 사이드바 -->


<!--  사이드바 -->
<div class="wrapper">
    
	<!-- Sidebar -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <h2>일일보고</h2>
			<div id="content" style="height:10px; width:10px; display:inline-block; margin-left:130px">

				<nav class="navbar navbar-expand-lg">
					<div class="container-fluid">
			
						<button type="button" id="sidebarCollapse" class="btn btn-secondary">
							<div id="outdentsidebar">
								<i class="fas fa-outdent"></i>
							</div>
		
							<div id="indentsidebar" style="display:none;">
								<i  class="fas fa-indent" ></i>
							</div>
							
							<span></span>
						</button>
					
					</div>
				</nav>
				<!-- <div id = checkbox style="z-index: 3; position:fixed; top :150px; padding:5px;border: 1px solid rgba(183, 180, 180, 0.839);border-radius:10px;color:grey;background-color: white;display:none; " >
					<input type="checkbox" name="meastitle" id="meas1" value="meassituation" style="color:grey;background-color: white;"checked/> 측정현황
					<br>
					<input type="checkbox" name="meastitle" id="meas11" value="meassituation5G"style="color:grey;" checked/> 5G
					<br>
					<input type="checkbox" name="meastitle" id="meas12" value="meassituationLTE"style="color:grey;" checked/> LTE
					<br>
					<input type="checkbox" name="meastitle" id="meas13" value="meassituationWiFi"style="color:grey;" checked/> WiFi
					<br>
					<input type="checkbox" name="meastitle" id="meas14" value="meassituationweak"style="color:grey;" checked/> 품질취약지역
					<br>
					<input type="checkbox" name="meastitle" id="meas2" value="measresult"style="color:grey;" checked/> 측정결과
					<br>
					<input type="checkbox" name="meastitle" id="meas21" value="measresult5G"style="color:grey;" checked/> 5G
					<br>
					<input type="checkbox" name="meastitle" id="meas22" value="measresultLTE"style="color:grey;background-color: white;" checked/> LTE
					<br>
					<input type="checkbox" name="meastitle" id="meas23" value="measresultWiFi" checked/> WiFi
					<br>
					<input type="checkbox" name="meastitle" id="meas24" value="measresultpost5G" checked/> 사후측정5G
					<br>
					<input type="checkbox" name="meastitle" id="meas25" value="measresultpostLTE" checked/> 사후측정LTE
					<br>
					<input type="checkbox" name="meastitle" id="meas3" value="measplus" /> 추가사항
				</div> -->
			
			</div>
        </div>

        <ul class="list-unstyled components">
            <li>
                <a href="{% url 'analysis:report' %}">일일보고</a>
            </li>
			<!-- <li>
                <a href="http://127.0.0.1:8000/smart/analysis/report/list/">일일보고 목록</a>
            </li> -->
			<li class="active">
                <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">일일보고 관리</a>
                <ul class="collapse list-unstyled" id="homeSubmenu">
                    <li>
                        <a href="{% url 'analysis:report_measplan' %}">측정대상등록</a>
                    </li>
                    <li>
                        <a href="{% url 'analysis:report_measresult' %}">측정완료현황</a>
                    </li>
                    <li>
                        <a href="{% url 'analysis:report_postmeas' %}">사후측정등록</a>
                    </li>
                </ul>
            </li>
        
        </ul>
    </nav>
	
	

</div>
<div id="blank" style="width:250px;"></div>

<div id="show1" style="margin:20px;border: 1px solid rgb(228, 223, 223); padding: 10px; width:95%;">
    <!-- <div id="search zone" style="text-align: right;">
        <input type="search" class="form-control" style="width:200px;display:inline;"></input>
        <button class="btn btn-primary" style="display:inline;" type="submit">검색</button>
    </div></br> -->
    <div id="utility zone" style="text-align: right;">
         <!-- 날짜검색 -->
        <div class="mt-1">
            <input style="height: 24px; width:160px;" type="date" class="form-control"
                   v-model="date">
        </div>
        <button class="btn btn-secondary" style="display:inline;" type="button" id="plus_meas" onclick="plus_meas()" >추가</button>
       
    </div></br>
    <div id="output" style="text-align: center;">
        <table id="closedata_table" class="table table-hover table-bordered ">
            <thead class="bg-light" id="cloasdata-header">
                <tr>
                    <th>날짜</th>
                    <th>측정명</th>
                    <th>구분{{price1}}</th>
                    <th>센터</th>
                    <th>모폴로지</th>
                    <th>지역</th>
                    <th>구군</th>
                    <th>상세정보</th>
                    <th>DL</th>
                    <th>UL</th>
                    <th>LTE전환율</th>
                    <th>전송성공율</th>
                    <th>접속</th>
                    <th>지연</th>
                    <th>추가사항</th>
                    <th>수정</th>
                </tr>
            </thead>
            <tbody id="closedata-body">
                
                {% for measclose in measclose %}
                 
                <tr data-value ="${measclose}">
                    <td style="display:none;"><p></p><input type = 'text'  name="phoneGroup" value="{{measclose.phoneGroup}}"></input></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.measdate}}</p> <input style="display:inline;" class="form-control mod" type="text" name="measdate" id="textmod1" value="{{measclose.measdate}}"></input></td>
                    <td style="width:15%"><p class="measclosedata">{{measclose.userInfo1}}</p> <input style="display:inline;" class="form-control mod" type="text" name="userInfo1" id="textmod2" value="{{measclose.userInfo1}}"></input></td> 
                    <td style="width:5%"><p class="measclosedata">{{measclose.nettype}}</p> 
                        <select style="display:inline;" class="form-control mod" type="text" name="nettype" id="textmod4" value="{{measclose.nettype}}">
                            <option value="{{measclose.nettype}}">{{measclose.nettype}}</option>
                            {% for networkid in networkid_list %}
                            <option value="{{networkid}}">{{networkid}}</option>
                            {% endfor %}
                        </select></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.center}}</p> 
                        <select style="display:inline;" class="form-control mod" type="text" name="center" id="textmod4" value="{{measclose.center}}">
                            <option value="{{measclose.center}}">{{measclose.center}}</option>
                            {% for center in center_list %}
                            <option value="{{center}}">{{center}}</option>
                            {% endfor %}
                        </select></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.mopho}}</p> <input style="display:inline;" class="form-control mod" type="text" name="mopho" id="textmod5" value="{{measclose.mopho}}"></input></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.district}}</p> 
                        <select style="display:inline;" class="form-control mod" type="text" name="district" id="textmod4" value="{{measclose.district}}">
                            <option value="{{measclose.district}}">{{measclose.district}}</option>
                            {% for district in district_list %}
                            <option value="{{district}}">{{district}}</option>
                            {% endfor %}
                        </select></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.guGun}}</p> <input style="display:inline;" class="form-control mod" type="text" name="guGun" id="textmod7" value="{{measclose.guGun}}"></input></td></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.detailadd}}</p> <input style="display:inline;" class="form-control mod" type="text" name="detailadd" id="textmod7" value="{{measclose.detailadd}}"></input></td></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.downloadBandwidth}}</p> <input style="display:inline;" class="form-control mod" type="text" name="downloadBandwidth" id="textmod6" value="{{measclose.downloadBandwidth}}"></input></td></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.uploadBandwidth}}</p> <input style="display:inline;" class="form-control mod" type="text" name="uploadBandwidth" id="textmod7" value="{{measclose.uploadBandwidth}}"></input></td></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.lte_percent}}</p> <input style="display:inline; " class="form-control mod" type="text" name="lte_percent" id="textmod7" value="{{measclose.lte_percent}}"></input></td></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.success_rate}}</p> <input style="display:inline;" class="form-control mod" type="text" name="success_rate" id="textmod7" value="{{measclose.success_rate}}"></input></td></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.connect_time}}</p> <input style="display:inline;" class="form-control mod" type="text" name="connect_time" id="textmod7" value="{{measclose.connect_time}}"></input></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.udpJitter}}</p> <input style="display:inline;" class="form-control mod" type="text" name="udpJitter" id="textmod7" value="{{measclose.udpJitter}}"></input></td>
                    <td style="width:5%"><p class="measclosedata">{{measclose.subadd}}</p> <input style="display:inline;" class="form-control mod" type="text" name="subadd" id="textmod7" value='{{measclose.subadd}}'></input></td>
                    <td style="width:10%"><button class="btn btn-secondary btn-sm modifybtn" onclick="modify_closedata()">수정 <i class="icon-fixed-width icon-pencil" onclick="event.stopPropagation()"></i></button> <button class="btn btn-secondary btn-sm completebtn" onclick="update_closedata()">완료 <i class="icon-fixed-width icon-check" onclick="event.stopPropagation()"></i></button>
                    <button class="btn btn-secondary btn-sm deletebtn" onclick="delete_closedata()">삭제 <i class="icon-trash" onclick="event.stopPropagation()"></i></button><button class="btn btn-secondary btn-sm canclebtn" onclick="cancle_closedata()">취소 <i class="icon-ban-circle" onclick="event.stopPropagation()"></i></button></td>    
                </tr>
               
                {% endfor %}
            
        
            </tbody>
        </table>
    </div>
</div>
</div>
</body>
{% endblock %}
{% block extra-script %}

{% csrf_token %}
<script src="https://unpkg.com/vue@2.4.2"></script>
<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

<!-- 테스트 사이드바 -->
<script>
    $(document).ready(function () {
    $('#sidebarCollapse').on('click', function () {
        $('#sidebar').toggleClass('active');
        $(this).toggleClass('active');
		$('#indentsidebar').toggle();
		$('#outdentsidebar').toggle();
    });
    });
    $('#report_nav').addClass('nav-item active');
	$('#dashboard_nav').removeClass('nav-item active');
	$('#dashboard_nav').addClass('nav-item');
    // 수정 완료 이벤트
    $('.canclebtn').hide();
    $('.mod').hide();
    $(".completebtn").hide();
</script>

<script>


async function update_closedata(){
    var targetBtn = event.target;
    var parentTr = targetBtn.parentNode.parentNode;
    var data_len = []
    for(let i=0; i < parentTr.children.length-1; i++){
        console.log($(parentTr.children[i].children[1]).val())
        data_len.push($(parentTr.children[i].children[1]).val())
    }
    console.log(data_len)
    const requestOptions = {         
                method: "POST",
                headers: {
                    "X-CSRFToken": '{{csrf_token}}',
                    "Content-Type": "application/json",
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    'select_tr': data_len
                    
                })
            };
                           
    const res = await fetch("/analysis/measresult/create/", requestOptions);
    const data = await res.json();
    
    console.log(data)
    if(data['result'] == 'ok'){
        window.location.reload()
    }
}
async function delete_closedata(){
    var targetBtn = event.target;
    var parentTr = targetBtn.parentNode.parentNode;
    var data_len = []
    for(let i=0; i < parentTr.children.length-1; i++){
        console.log($(parentTr.children[i].children[1]).val())
        data_len.push($(parentTr.children[i].children[1]).val())
    }
    console.log(data_len)
    const requestOptions = {         
                method: "POST",
                headers: {
                    "X-CSRFToken": '{{csrf_token}}',
                    "Content-Type": "application/json",
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    'select_tr': data_len
                    
                })
            };
                           
    const res = await fetch("/analysis/measresult/delete/", requestOptions);
    const data = await res.json();
    
    console.log(data)
    if(data['result'] == 'ok'){
        window.location.reload()
    }
}
function modify_closedata(){
 
    var targetBtn = event.target;
	var parentTr = targetBtn.parentNode.parentNode;
	var tdNode = parentTr.childNodes;
    parentTr.className = "updateRow";
	var row = document.querySelectorAll('.updateRow')
    $('.updateRow').find('.mod').show();
    $('.updateRow').find('.canclebtn').show();
    $('.updateRow').find('.completebtn').show();
    $('.updateRow').find('.modifybtn').hide();
    $('.updateRow').find('.deletebtn').hide();
    $('.updateRow').find('.measclosedata').hide();	
	parentTr.classList.remove("updateRow");
}

function cancle_closedata(){
     
    var targetBtn = event.target;
    var parentTr = targetBtn.parentNode.parentNode;
    var tdNode = parentTr.childNodes;
    parentTr.className = "updateRow";
    var row = document.querySelectorAll('.updateRow')
    $('.updateRow').find('.modifybtn').show();
    $('.updateRow').find('.canclebtn').hide();
    $('.updateRow').find('.completebtn').hide();
    $('.updateRow').find('.deletebtn').show();
    $('.updateRow').find('.mod').hide();
    $('.updateRow').find('.measclosedata').show();	
    parentTr.classList.remove("updateRow");
}

async function plus_meas(){
    $("#closedata_table").find("thead tr:first").after('<tr><td style="display:none;"><p></p><input value=999></input></td>\
    <td><p></p><input class="form-control mod " value="추가"></input></td><td><p></p><input class="form-control mod " value="추가"></input></td>\
    <td><p></p><input class="form-control mod " value="추가"></input></td><td><p></p><input class="form-control mod " value="추가"></input></td><td><p></p><input class="form-control mod " value="추가"></input></td><td><p></p><input class="form-control mod " value="추가"></input></td><td><p></p><input class="form-control mod " value="추가"></input></td>\
    <td><p></p><input class="form-control mod " value="추가"></input></td><td><p></p><input class="form-control mod " value=0></input></td><td><p></p><input class="form-control mod " value=0></input></td><td><p></p><input class="form-control mod " value=0></input></td>\
    <td><p></p><input class="form-control mod " value=0></input></td><td><p></p><input class="form-control mod " value=0></input></td><td><p></p><input class="form-control mod " value=0></input></td><td><p></p><input class="form-control mod " value="추가"></input></td><td>\
    <button class="btn btn-secondary btn-sm completebtn" onclick="update_closedata()">완료 <i class="icon-fixed-width icon-check" onclick="event.stopPropagation()"></i></button>\
    <button class="btn btn-secondary btn-sm deletebtn"onclick="plus_meascancle()"">삭제 <i class="icon-trash" onclick="event.stopPropagation()"></i></button></td></tr>');
    
     
}async function plus_meascancle(){
    $("#closedata_table").find("thead tr:last").remove();
    
     
}
async function fetch_all_phoneGroup() {
                    const res = await fetch("/api/measresult/closedatalist/" + this.date);
                    
                            
}
                
</script>
<!-- <script>
    const vm = new Vue({
            delimiters: ['[[', ']]'], // 장고 탬플릿 테그와 구별하기 위해 사용
            el: '#app',
            data() {
                return {
                    measclose : []
                }

            },
            methods:{
                async update_closedata(){
                    var targetBtn = event.target;
                    var parentTr = targetBtn.parentNode.parentNode;
                    var data_len = []
                    for(let i=0; i < parentTr.children.length-1; i++){
                        console.log($(parentTr.children[i].children[1]).val())
                        data_len.push($(parentTr.children[i].children[1]).val())
                    }
                    console.log(data_len)
                    const requestOptions = {         
                                method: "POST",
                                headers: {
                                    "X-CSRFToken": '{{csrf_token}}',
                                    "Content-Type": "application/json",
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify({
                                    'select_tr': data_len
                                    
                                })
                            };
                                        
                    const res = await fetch("/analysis/measresult/create/", requestOptions);
                    const data = await res.json();
                    
                    console.log(data)
                    if(data['result'] == 'ok'){
                        window.location.reload()
                    }
                },

                modify_closedata(){
                
                    var targetBtn = event.target;
                    var parentTr = targetBtn.parentNode.parentNode;
                    var tdNode = parentTr.childNodes;
                    parentTr.className = "updateRow";
                    var row = document.querySelectorAll('.updateRow')
                    $('.updateRow').find('.mod').show();
                    $('.updateRow').find('.canclebtn').show();
                    $('.updateRow').find('.completebtn').show();
                    $('.updateRow').find('.modifybtn').hide();
                    $('.updateRow').find('.deletebtn').hide();
                    $('.updateRow').find('.measclosedata').hide();	
                    parentTr.classList.remove("updateRow");
                },

                cancle_closedata(){
                    
                    var targetBtn = event.target;
                    var parentTr = targetBtn.parentNode.parentNode;
                    var tdNode = parentTr.childNodes;
                    parentTr.className = "updateRow";
                    var row = document.querySelectorAll('.updateRow')
                    $('.updateRow').find('.modifybtn').show();
                    $('.updateRow').find('.canclebtn').hide();
                    $('.updateRow').find('.completebtn').hide();
                    $('.updateRow').find('.deletebtn').show();
                    $('.updateRow').find('.mod').hide();
                    $('.updateRow').find('.measclosedata').show();	
                    parentTr.classList.remove("updateRow");
                },

                async plus_meas(){
                    
                    var data_len = []
                    for(let i=0; i < 15; i++){
                        
                        data_len.push($(parentTr.children[i].children[1]).val())
                    }
                    console.log(data_len)
                    const requestOptions = {         
                                method: "POST",
                                headers: {
                                    "X-CSRFToken": '{{csrf_token}}',
                                    "Content-Type": "application/json",
                                    'Accept': 'application/json'
                                },
                                body: JSON.stringify({
                                    'select_tr': data_len
                                    
                                })
                            };
                                        
                    const res = await fetch("/analysis/measresult/create/", requestOptions);
                    const data = await res.json();
                    
                    console.log(data)
                    if(data['result'] == 'ok'){
                        window.location.reload()
                    } 
                    
                }
                            }
                    })
</script> -->

{% endblock %}